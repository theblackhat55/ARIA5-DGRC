<!DOCTYPE html>
<html>
<head>
    <title>Auth Test</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
</head>
<body>
    <h1>Browser Authentication Test</h1>
    
    <div id="status">Starting test...</div>
    
    <script>
    async function testAuth() {
        const statusDiv = document.getElementById('status');
        
        try {
            // Step 1: Test login
            statusDiv.innerHTML = 'Step 1: Testing login...';
            
            const loginResponse = await fetch('https://2ae7e6c1.aria5-ti-enhancement.pages.dev/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'username=admin&password=demo123',
                credentials: 'include' // This is important for cookies
            });
            
            statusDiv.innerHTML += '<br>Login response status: ' + loginResponse.status;
            statusDiv.innerHTML += '<br>Login response headers: ' + JSON.stringify([...loginResponse.headers.entries()]);
            
            // Step 2: Test dashboard access
            statusDiv.innerHTML += '<br><br>Step 2: Testing dashboard access...';
            
            const dashboardResponse = await fetch('https://2ae7e6c1.aria5-ti-enhancement.pages.dev/dashboard', {
                credentials: 'include' // This is important for cookies
            });
            
            statusDiv.innerHTML += '<br>Dashboard response status: ' + dashboardResponse.status;
            statusDiv.innerHTML += '<br>Dashboard response URL: ' + dashboardResponse.url;
            
            const dashboardText = await dashboardResponse.text();
            if (dashboardText.includes('Executive Dashboard')) {
                statusDiv.innerHTML += '<br>✅ Dashboard accessible!';
            } else if (dashboardText.includes('Login')) {
                statusDiv.innerHTML += '<br>❌ Redirected to login page';
            } else {
                statusDiv.innerHTML += '<br>❓ Unexpected response';
            }
            
        } catch (error) {
            statusDiv.innerHTML += '<br>❌ Error: ' + error.message;
        }
    }
    
    testAuth();
    </script>
</body>
</html>